<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <style>
        #screen {
            display: grid;
            grid-template-columns: 1fr 1em 1fr;
            /* background-color: aliceblue; */
            width: 250px;
            height: 1.5em;
            text-align: right;
        }
        #screenA {
            background-color: aliceblue;
            padding-right: 5px;
            border-right: 1px solid grey;
        }
        #screenOp {
            background-color: aliceblue;
            border: 1px solid blue;
        }
        #screenB {
            background-color: aliceblue;
            padding-left: 5px;
        }
        #keypad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            width: 250px;
        }
        .numkey {
            
            width: 40px;
            height: 40px;
            line-height: 40px;
            border: 1px solid black;
            border-radius: 3px;
            text-align: center;
            vertical-align: middle;
            font-size: 1.5em;
            margin:5px;
        }
        .ctrlKey {
            
            font-size: 1em;
        }
    </style>
</head>
<body>
    
    <div id="screen"> 
        <div id="screenA"></div>
        <div id="screenOp"></div>
        <div id="screenB"></div>
    </div>

    <div id="keypad">
        <div id="n-7" class="numkey">7</div>
        <div id="n-8" class="numkey">8</div>
        <div id="n-9" class="numkey">9</div>
        <div id="n-del" class="numkey ctrlKey" >DEL</div>
        <div id="n-ac" class="numkey ctrlKey" >AC</div>

        <div id="n-4" class="numkey">4</div>
        <div id="n-5" class="numkey">5</div>
        <div id="n-6" class="numkey">6</div>
        <div id="n-×" class="numkey oppKey">×</div>
        <div id="n-÷" class="numkey oppKey">÷</div>

        <div id="n-1" class="numkey">1</div>
        <div id="n-2" class="numkey">2</div>
        <div id="n-3" class="numkey">3</div>
        <div id="n-+" class="numkey oppkey">+</div>
        <div id="n-−" class="numkey oppkey">−</div>

        <div id="n-0" class="numkey">0</div>
        <div id="n-±" class="numkey oppkey">±</div>
        <div id="n-." class="numkey">.</div>
        <div id="n-E" class="numkey oppkey">E</div>
        <div id="n-=" class="numkey oppkey">=</div>

    </div>


</body>

<script>

    result = 0;
    oldResult = 0;
    operation = "";
    nDecimals = 0;
    showDecimal = false;

    ADiv = document.getElementById("screenA");
    opDiv = document.getElementById("screenOp");
    BDiv = document.getElementById("screenB");
    // screenDiv = document.getElementById("screen");

    let keys = document.getElementsByClassName("numkey");
    let oppKeys = document.getElementsByClassName("oppkey");
    
    
    for (key of keys) {
        key.addEventListener("click", function(){
            console.log(this.id, this.textContent);
            keyId = this.textContent;

            if ("0123456789".includes(keyId)){
                console.log("result a.", result);
                // if (showDecimal){
                //     nDecimals += 1;
                // }
                console.log(nDecimals)
                result = result*(10**(nDecimals+1)) + parseInt(keyId);
                console.log("result b.", result);
                if (showDecimal){
                    nDecimals += 1;
                    result = result / (10**nDecimals);
                    result = Number(result.toFixed(nDecimals));
                }
                console.log("result c.", result);
                onB(result);
                
            }
            else if (keyId === "."){
                if (showDecimal === false) {
                    showDecimal = true;
                    onB(result.toFixed()+".");
                }
                
            }
            else if ('+−×÷'.includes(keyId)){
                console.log("operation", operation, operation === "")
                // if there is an opperation indicated
                if (operation !== "") {
                    //execute operation
                    calculate();
                    


                }

                highlightKey(keyId);
                operation = keyId;
                oldResult = result;
                // reset
                showDecimal = false;
                nDecimals = 0;
                result = 0;
                
                onA(oldResult);
                onOp(operation);
                onB(0);
                

            }
            else if (keyId === "AC") {
                result = 0;
                oldResult = 0;
                operation = "";
                showDecimal = false;
                nDecimals = 0;
                onA("");
                onOp("");
                onB(0);
                resetOppKeys();
            }
            else if (keyId === 'DEL'){
                if (showDecimal) {
                    nDecimals -= 1;
                    result = result*10**(nDecimals);
                    result = Math.trunc(result);
                    result = result / (10**nDecimals);
                }
                else {
                    result = result / 10;
                    result = Math.trunc(result);
                }
                
                onB(result);
            }
            else if (keyId === "="){

                calculate();

                operation = "";
                showDecimal = false;
                nDecimals = 0;
                resetOppKeys();

            }
            
        })
    }
            
    function calculate(){
        operation = opDiv.textContent;
        let calc = ADiv.textContent + operation + BDiv.textContent;

        if (operation === "+"){
            result = oldResult + result;
        }
        else if (operation === "−"){
            result = oldResult - result;
        }
        else if (operation === "×"){
            result = oldResult * result;
        }
        else if (operation === "÷"){
            result = oldResult / result;
        }

        resetKey(operation);

        onA(calc);
        onOp("=");
        onB(result);
    }

    function highlightKey(id){
        let divId = "n-" + id;
        let div = document.getElementById(divId);
        div.style.backgroundColor = "yellow";
    }
    function resetKey(id){
        divId = "n-" + id;
        div = document.getElementById(divId);
        if (div !== undefined) {
            div.style.backgroundColor = "white";
        }
    }

    function resetOppKeys(){
        for (let key of oppKeys){
            console.log(key.textContent);
            resetKey(key.textContent);
        }
    }
    function onScreen(val){
        screenDiv.textContent = val;
    }

    function onA(val){
        if (typeof(val) !== 'string'){
            if (!showDecimal) {
                val = Number(val.toFixed(10));
            }
        }
        ADiv.textContent = val;
    }
    function clearA(){
        ADiv.textContent = "";
    }
    function onOp(op){
        opDiv.textContent = op;
    }
    function clearOp(){
        opDiv.textContent = "";
    }
    function onB(val){
        if (typeof(val) !== 'string'){
            if (!showDecimal) {
                val = Number(val.toFixed(10));
            }
        }
        BDiv.textContent = val;
    }
    function clearB(){
        BDiv.textContent = "";
    }



</script>
</html>